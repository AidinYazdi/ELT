<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Einayim L'Torah - Newsletter Generator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #0a4a6b 0%, #1a7a9b 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .form-container {
      padding: 40px;
    }

    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #0a9eb5;
    }

    .section h2 {
      color: #0a4a6b;
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 0.95em;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-family: inherit;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #0a9eb5;
    }

    .form-group textarea {
      min-height: 200px;
      resize: vertical;
      font-family: 'Georgia', serif;
      line-height: 1.6;
    }

    .article-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 2px solid #e0e0e0;
    }

    .article-section h3 {
      color: #0a4a6b;
      margin-bottom: 15px;
      font-size: 1.2em;
      border-bottom: 2px solid #0a9eb5;
      padding-bottom: 10px;
    }

    .format-help {
      background: #e8f4f8;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 0.9em;
      color: #555;
    }

    .format-help strong {
      color: #0a4a6b;
    }

    .format-help code {
      background: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      color: #c7254e;
    }

    .btn-container {
      text-align: center;
      margin-top: 30px;
      padding-top: 30px;
      border-top: 2px solid #e0e0e0;
    }

    .btn-print {
      background: linear-gradient(135deg, #0a9eb5 0%, #0a4a6b 100%);
      color: white;
      border: none;
      padding: 18px 50px;
      font-size: 1.2em;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(10, 158, 181, 0.4);
    }

    .btn-print:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(10, 158, 181, 0.6);
    }

    .btn-print:active {
      transform: translateY(0);
    }

    .btn-print:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      display: none;
      text-align: center;
      margin-top: 20px;
      color: #0a4a6b;
      font-weight: 600;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #0a9eb5;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .success-message {
      display: none;
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 6px;
      margin-top: 20px;
      border: 1px solid #c3e6cb;
    }

    .success-message.show {
      display: block;
    }

    .error-message {
      display: none;
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 6px;
      margin-top: 20px;
      border: 1px solid #f5c6cb;
    }

    .error-message.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Einayim L'Torah</h1>
      <p>Newsletter Generator</p>
    </div>

    <div class="form-container">
      <form id="newsletterForm">
        <!-- Metadata Section -->
        <div class="section">
          <h2>Newsletter Information</h2>
          <div class="form-row">
            <div class="form-group">
              <label for="volume">Volume</label>
              <input type="text" id="volume" name="volume" placeholder="1" value="1">
            </div>
            <div class="form-group">
              <label for="issue">Issue</label>
              <input type="text" id="issue" name="issue" placeholder="6" value="6">
            </div>
            <div class="form-group">
              <label for="parsha">Parsha</label>
              <input type="text" id="parsha" name="parsha" placeholder="Lech Lecha" required>
            </div>
            <div class="form-group">
              <label for="year">Year</label>
              <input type="text" id="year" name="year" placeholder="5786" value="5786">
            </div>
          </div>
        </div>

        <!-- Formatting Help -->
        <div class="section">
          <h2>Formatting Guide</h2>
          <div class="format-help">
            <p><strong>How to format your text:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
              <li><code>**Bold text**</code> for <strong>bold</strong></li>
              <li><code>*Italic text*</code> for <em>italic</em></li>
              <li><code>__Underlined text__</code> for <u>underline</u></li>
              <li><code>***Bold and Italic***</code> for <strong><em>both</em></strong></li>
              <li>Use double line breaks for new paragraphs</li>
            </ul>
            <p style="margin-top: 10px;"><em>Note: You can also paste directly from Google Docs and manually add formatting markers.</em></p>
          </div>
        </div>

        <!-- Articles Section -->
        <div class="section">
          <h2>Articles</h2>

          <!-- Roshei Yeshiva Article -->
          <div class="article-section">
            <h3>From the Roshei Yeshiva</h3>
            <div class="form-group">
              <label for="roshei_yeshiva_author">Author (optional - defaults to Rabbi Daniel Stein)</label>
              <input type="text" id="roshei_yeshiva_author" name="roshei_yeshiva_author" placeholder="Rabbi Daniel Stein">
            </div>
            <div class="form-group">
              <label for="roshei_yeshiva_content">Article Content</label>
              <textarea id="roshei_yeshiva_content" name="roshei_yeshiva_content" placeholder="Paste article content here..."></textarea>
            </div>
          </div>

          <!-- Student Dvar Torah -->
          <div class="article-section">
            <h3>Student Dvar Torah</h3>
            <div class="form-group">
              <label for="student_dvar_author">Author (required for this section)</label>
              <input type="text" id="student_dvar_author" name="student_dvar_author" placeholder="Student Name">
            </div>
            <div class="form-group">
              <label for="student_dvar_content">Article Content</label>
              <textarea id="student_dvar_content" name="student_dvar_content" placeholder="Paste article content here..."></textarea>
            </div>
          </div>

          <!-- Sichos Mussar -->
          <div class="article-section">
            <h3>Sichos Mussar</h3>
            <div class="form-group">
              <label for="sichos_mussar_author">Author (optional - defaults to Rabbi Yaakov Feit)</label>
              <input type="text" id="sichos_mussar_author" name="sichos_mussar_author" placeholder="Rabbi Yaakov Feit">
            </div>
            <div class="form-group">
              <label for="sichos_mussar_content">Article Content</label>
              <textarea id="sichos_mussar_content" name="sichos_mussar_content" placeholder="Paste article content here..."></textarea>
            </div>
          </div>

          <!-- Halacha Corner -->
          <div class="article-section">
            <h3>Halacha Corner</h3>
            <div class="form-group">
              <label for="halacha_corner_author">Author (optional - defaults to Rabbi Aryeh Lebowitz)</label>
              <input type="text" id="halacha_corner_author" name="halacha_corner_author" placeholder="Rabbi Aryeh Lebowitz">
            </div>
            <div class="form-group">
              <label for="halacha_corner_content">Article Content</label>
              <textarea id="halacha_corner_content" name="halacha_corner_content" placeholder="Paste article content here..."></textarea>
            </div>
          </div>

          <!-- Shiur Yomi -->
          <div class="article-section">
            <h3>From the Shiur Yomi of</h3>
            <div class="form-group">
              <label for="shiur_yomi_author">Author (optional - defaults to Rabbi Elchanan Adler)</label>
              <input type="text" id="shiur_yomi_author" name="shiur_yomi_author" placeholder="Rabbi Elchanan Adler">
            </div>
            <div class="form-group">
              <label for="shiur_yomi_content">Article Content</label>
              <textarea id="shiur_yomi_content" name="shiur_yomi_content" placeholder="Paste article content here..."></textarea>
            </div>
          </div>

          <!-- Min HaMesorah -->
          <div class="article-section">
            <h3>Min HaMesorah</h3>
            <div class="form-group">
              <label for="min_hamesorah_author">Author (optional - defaults to current featured rabbi)</label>
              <input type="text" id="min_hamesorah_author" name="min_hamesorah_author" placeholder="Rabbi Dr. Samuel Belkin">
            </div>
            <div class="form-group">
              <label for="min_hamesorah_content">Article Content</label>
              <textarea id="min_hamesorah_content" name="min_hamesorah_content" placeholder="Paste article content here..."></textarea>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="btn-container">
          <button type="submit" class="btn-print" id="printBtn">Generate PDF</button>
          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Generating your newsletter PDF...</p>
          </div>
          <div class="success-message" id="successMessage">
            PDF generated successfully! Your download should start automatically.
          </div>
          <div class="error-message" id="errorMessage">
            Error generating PDF. Please try again.
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    document.getElementById('newsletterForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const printBtn = document.getElementById('printBtn');
      const loading = document.getElementById('loading');
      const successMessage = document.getElementById('successMessage');
      const errorMessage = document.getElementById('errorMessage');

      // Hide previous messages
      successMessage.classList.remove('show');
      errorMessage.classList.remove('show');

      // Show loading
      printBtn.disabled = true;
      loading.classList.add('show');

      try {
        // Gather metadata
        const metadata = {
          volume: document.getElementById('volume').value,
          issue: document.getElementById('issue').value,
          parsha: document.getElementById('parsha').value,
          year: document.getElementById('year').value
        };

        // Gather articles
        const articles = {
          roshei_yeshiva: {
            title: 'From the Roshei Yeshiva:',
            author: document.getElementById('roshei_yeshiva_author').value,
            content: document.getElementById('roshei_yeshiva_content').value,
            page: '1'
          },
          student_dvar: {
            title: 'Student Dvar Torah',
            author: document.getElementById('student_dvar_author').value,
            content: document.getElementById('student_dvar_content').value,
            page: '2'
          },
          sichos_mussar: {
            title: 'Sichos Mussar',
            author: document.getElementById('sichos_mussar_author').value,
            content: document.getElementById('sichos_mussar_content').value,
            page: '4'
          },
          halacha_corner: {
            title: 'Halacha Corner',
            author: document.getElementById('halacha_corner_author').value,
            content: document.getElementById('halacha_corner_content').value,
            page: '4'
          },
          shiur_yomi: {
            title: 'From the Shiur Yomi of',
            author: document.getElementById('shiur_yomi_author').value,
            content: document.getElementById('shiur_yomi_content').value,
            page: '5'
          },
          min_hamesorah: {
            title: 'Min HaMesorah',
            author: document.getElementById('min_hamesorah_author').value,
            content: document.getElementById('min_hamesorah_content').value,
            page: '6'
          }
        };

        // Send to server
        const response = await fetch('/generate-pdf', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ metadata, articles })
        });

        if (!response.ok) {
          throw new Error('PDF generation failed');
        }

        // Download PDF
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ELT_${metadata.parsha}.pdf`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

        // Show success
        loading.classList.remove('show');
        successMessage.classList.add('show');
        printBtn.disabled = false;

      } catch (error) {
        console.error('Error:', error);
        loading.classList.remove('show');
        errorMessage.classList.add('show');
        errorMessage.textContent = 'Error generating PDF: ' + error.message;
        printBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
